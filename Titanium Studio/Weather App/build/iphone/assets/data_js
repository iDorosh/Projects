var ui=require("ui"),ui2=require("ui2"),jsonData2=[],test=!0,netCheck=function(e,t){var a=(require("ui"),"http://api.wunderground.com/api/035012bdcd3a3f65/conditions/q/"+t+","+e+".json");if(Ti.Network.online){var r=Ti.Network.createHTTPClient();r.onload=function(e){var t=JSON.parse(this.responseText),a=t.current_observation,r=a.display_location.city,n=a.display_location.state_name,i=a.temp_f,o=a.weather,s=function(){var e=Math.round((new Date).getHours()),t=Math.round((new Date).getMinutes());if(e>12)var e=e-12,t=t+"pm";else var e=e,t=t+"am";return 10>t?e+":0"+t:e+":"+t};test=!0,Ti.App.Properties.setString("timestamp",s()),create(r,n,o,i),read()},r.open("GET",a),r.send()}else alert("Network currently unavailable."),test=!1,read()};exports.netCheck=netCheck;var netCheck2=function(e,t){var a=(require("ui"),"http://api.wunderground.com/api/035012bdcd3a3f65/hourly/q/"+t+","+e+".json");if(Ti.Network.online){var r=Ti.Network.createHTTPClient();r.onload=function(a){var r=JSON.parse(this.responseText);jsonData2=r.hourly_forecast,netCheck(e,t)},r.open("GET",a),r.send()}else alert("Network currently unavailable."),test=!1,read()};exports.netCheck=netCheck,exports.netCheck2=netCheck2;var currentLocation=function(){if(1==Titanium.Network.online)Ti.Geolocation.purpose="To find weather conditions near you.",Titanium.Geolocation.getCurrentPosition(function(e){if(!e.success)return void alert("Could not retrieve location");var t=e.coords.longitude,a=e.coords.latitude;netCheck2(t,a)});else{var e=Ti.UI.createAlertDialog({message:"Could not retrieve location",title:"Network Unavailable"});e.show(),test=!1,read()}};exports.currentLocation=currentLocation,Ti.Database.install("weather.sqlite","weather");var create=function(e,t,a,r){var n=Ti.Database.open("weather");n.execute("INSERT INTO data (city,state,condition,temp) VALUES(?,?,?,?)",e,t,a,r);n.lastInsertRowId;n.close(),tblData=[]};exports.create=create;var tblData=[],read=function(e){for(var t=Ti.Database.open("weather"),a=t.execute("SELECT id,city,state,condition,temp FROM data");a.isValidRow();)tblData.push({id:a.fieldByName("id"),city:a.fieldByName("city"),state:a.fieldByName("state"),condition:a.fieldByName("condition"),temp:a.fieldByName("temp")}),a.next();1==test?ui.userInterface(tblData,jsonData2):ui2.userInterface2(tblData,jsonData2),a.close(),t.close(),ui.profilesTable=tblData};exports.read=read;